import {Example, PreviewList} from 'components';
import {Link} from 'react-router-dom';

Execute a callback when clicking outside a given component, based on the React component tree rather than
the DOM tree in order to support portals.

This hook adds a `mousedown` and `mouseup` event listeners to the document that will trigger the given function if
the target is determined to be outside the component to which the returned `onMouseDownCapture` handler
is attached.

> For class components use <Link to='/docs/tools/clickoutside'>&lt;ClickOutside/&gt;</Link>

#### How Does It Work?

This solution is based on a similar solution taken from [React Data Grid](https://github.com/adazzle/react-data-grid/pull/1417/files#diff-fdcbe490b776c1eed24c88d4b5f27d66R4)
In short, we leverage the power of event bubbling in React, which works based on React's Component tree
rather than the DOM tree, allowing us to accurately detect clicks through portals.
So once a click is detected in the component tree of the target component, we set a flag, which the
document event handler is checking against. When set to true, the click is considered to be "inside"
and so it is ignored.

This solution is further improved by separating the `click` event into `mousedown` and `mouseup`,
allowing us to cover cases where the mouse is clicked inside the element, but released outside the
element (for example, when dragging or resizing). In such cases the click is still considered as
an inside click, since it originated inside the element.

#### Caveats

Since `useClickOutside()` attaches events to the document as soon as it is called, you should use it sparingly.
Detecting outside clicks is usually needed for popover-type components.
In such cases, since the popover is only rendered when it is opened, you should only call the hook when the corresponding popover
is rendered, rather than calling it initially.

For example, this is preferable:

```jsx
const Popover = () => {
    // The events will only be attached when the popover is visible
    const handleOnMouseDownCapture = useClickOutside(...);
    return <Poppable onMouseDownCapture={handleOnMouseDownCapture}/>
}

const App = () => (
    <div>
        {visible && <Popover/>}
    </div>
);
```

To this:

```jsx
const Popover = ({onMouseDownCapture}) => (
    <Poppable onMouseDownCapture={onMouseDownCapture}/>
);

const App = () => {
    // The events will be (redundantly) attached regardless of the visibility of the popover
    const handleOnMouseDownCapture = useClickOutside(...);
    return (
        <div>
            {visible && <Popover onMouseDownCapture={handleOnMouseDownCapture}/>}
        </div>
    );
};
```

## Basic Example

<Example file='docs/hooks/useclickoutside/BasicExample' height={250}/>

In the above example, clicking inside the box will change the text to `Inside`, and clicking
outside the box will change the text to `Outside`.

Pass the returned handler as `onMouseDownCapture` prop to the target component.

```js
import {useClickOutside} from 'webrix/hooks';

const handleOnMouseDownCapture = useClickOutside(() => {
    // Do something when clicking outside the target element
});

<SomeComponent onMouseDownCapture={handleOnMouseDownCapture}/>
```

## Portals

<Example file='docs/hooks/useclickoutside/Portals' height={250}/>

In the example above clicking in any one of the divs will change their background
color to pink. Clicking outside will turn it white again.

The 3 divs are "portaled" into the document's body, making them all sibling in the DOM.
However, they are nested in the React component tree, and therefore clicking on any of them will be
considered as a click "inside".

## Condition Overriding

It is sometimes necessary to override the condition of one or more `ClickOutside` components. To achieve that you can wrap an element with `<ClickOutsideOverride/>`.
See also: <Link to='/docs/tools/clickoutside#condition-overriding'>&lt;ClickOutsideOverride/&gt;</Link>

## Examples

<PreviewList query={['useclickoutside', 'clickoutside']}/>

## Syntax

```js
// As a hook
const handleOnMouseDownCapture = useClickOutside(callback);

```

### Importing

```jsx
// ESM
import {useClickOutside} from 'webrix/hooks';
import {useClickOutside} from 'webrix/hooks/useClickOutside'; // For better tree shaking


// UMD
const {useClickOutside} = Webrix.hooks;
```

### Parameters

#### `useClickOutside()`

name|type|description
---|---|---
`callback`|function|A function to be executed when clicking outside the DOM Element to which the returned click capture handler is attached

### Return Value

#### `useClickOutside()`

Returns a `Function` to be used as a click capture event handler on the target element.
