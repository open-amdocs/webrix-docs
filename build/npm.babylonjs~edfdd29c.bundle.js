(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{wAMR:function(e,t,i){"use strict";i.d(t,"b",(function(){return x})),i.d(t,"a",(function(){return P}));var r=i("mrSG"),n=i("ps+7"),a=i("YKqZ"),s=i("Dc3z"),o=i("cSa5"),h=i("/SR9"),l=i("Xeau"),c=i("Ufda"),d=i("y4Ty"),u=i("UtUh"),f=i("yk6c"),g=i("ikaq"),p=i("C1Wc"),m=i("T5H4"),y=i("cdI9"),v=i("jI0L"),b=i("mzcJ"),_=i("ADVu"),M=i("uyO6"),I=i("WHS4"),D=i("n5HA"),S=i("Yap0"),A=i("I2E9"),B=i("O3Sr"),x=function(){},O=function(){this.visibleInstances={},this.batchCache=new w,this.instancesBufferSize=2048},w=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},V=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null},P=function(e){function t(i,r,n,a,h,l){void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),void 0===l&&(l=!0);var c=e.call(this,i,r)||this;if(c._internalMeshDataInfo=new V,c.delayLoadState=0,c.instances=new Array,c._creationDataStorage=null,c._geometry=null,c._instanceDataStorage=new O,c._effectiveMaterial=null,c._shouldGenerateFlatShading=!1,c._originalBuilderSideOrientation=t.DEFAULTSIDE,c.overrideMaterialSideOrientation=null,r=c.getScene(),a){if(a._geometry&&a._geometry.applyToMesh(c),s.a.DeepCopy(a,c,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable","lightSources","morphTargetManager"],["_poseMatrix"]),c._internalMeshDataInfo._source=a,r.useClonedMeshMap&&(a._internalMeshDataInfo.meshMap||(a._internalMeshDataInfo.meshMap={}),a._internalMeshDataInfo.meshMap[c.uniqueId]=c),c._originalBuilderSideOrientation=a._originalBuilderSideOrientation,c._creationDataStorage=a._creationDataStorage,a._ranges){var d=a._ranges;for(var i in d)d.hasOwnProperty(i)&&d[i]&&c.createAnimationRange(i,d[i].from,d[i].to)}var u;if(a.metadata&&a.metadata.clone?c.metadata=a.metadata.clone():c.metadata=a.metadata,o.a&&o.a.HasTags(a)&&o.a.AddTagsTo(c,o.a.GetTags(a,!0)),c.parent=a.parent,c.setPivotMatrix(a.getPivotMatrix()),c.id=i+"."+a.id,c.material=a.material,!h)for(var f=a.getDescendants(!0),g=0;g<f.length;g++){var p=f[g];p.clone&&p.clone(i+"."+p.name,c)}if(a.morphTargetManager&&(c.morphTargetManager=a.morphTargetManager),r.getPhysicsEngine){var m=r.getPhysicsEngine();if(l&&m){var y=m.getImpostorForPhysicsObject(a);y&&(c.physicsImpostor=y.clone(c))}}for(u=0;u<r.particleSystems.length;u++){var v=r.particleSystems[u];v.emitter===a&&v.clone(v.name,c)}c.refreshBoundingInfo(),c.computeWorldMatrix(!0)}return null!==n&&(c.parent=n),c._instanceDataStorage.hardwareInstancedRendering=c.getEngine().getCaps().instancedArrays,c}return Object(r.c)(t,e),t._GetDefaultSideOrientation=function(e){return e||t.FRONTSIDE},Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new n.a),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new n.a),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new n.a),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new n.a),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!0,configurable:!0}),t.prototype.instantiateHierarchy=function(e,t,i){void 0===e&&(e=null);var r=!(this.getTotalVertices()>0)||t&&t.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));r&&(r.parent=e||this.parent,r.position=this.position.clone(),r.scaling=this.scaling.clone(),this.rotationQuaternion?r.rotationQuaternion=this.rotationQuaternion.clone():r.rotation=this.rotation.clone(),i&&i(this,r));for(var n=0,a=this.getChildTransformNodes(!0);n<a.length;n++){a[n].instantiateHierarchy(r,t,i)}return r},t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){var i=e.prototype.toString.call(this,t);if(i+=", n vertices: "+this.getTotalVertices(),i+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)i+=", animation[0]: "+this.animations[r].toString(t);if(t)if(this._geometry){var n=this.getIndices(),a=this.getVerticesData(d.b.PositionKind);a&&n&&(i+=", flat shading: "+(a.length/3===n.length?"YES":"NO"))}else i+=", flat shading: UNKNOWN";return i},t.prototype._unBindEffect=function(){e.prototype._unBindEffect.call(this);for(var t=0,i=this.instances;t<i.length;t++){i[t]._unBindEffect()}},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!0,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort((function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0}))},t.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return M.a.Warn("You cannot use a mesh as LOD level twice"),this;var i=new A.a(e,t);return this._internalMeshDataInfo._LODLevels.push(i),t&&(t._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++){var r=t._LODLevels[i];if(r.distance===e)return r.mesh}return null},t.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,i=0;i<t._LODLevels.length;i++)t._LODLevels[i].mesh===e&&(t._LODLevels.splice(i,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,t){var i,r=this._internalMeshDataInfo;if(!r._LODLevels||0===r._LODLevels.length)return this;t?i=t:i=this.getBoundingInfo().boundingSphere;var n=i.centerWorld.subtract(e.globalPosition).length();if(r._LODLevels[r._LODLevels.length-1].distance>n)return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this;for(var a=0;a<r._LODLevels.length;a++){var s=r._LODLevels[a];if(s.distance<n)return s.mesh&&(s.mesh._preActivate(),s.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(n,this,s.mesh),s.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(n,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,t,i){return this._geometry?this._geometry.getVerticesData(e,t,i):null},t.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}return this._geometry.getVerticesDataKinds()},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),2===this.delayLoadState)return!1;if(!e.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;var r=this.getEngine(),n=this.getScene(),a=i||r.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var s=this.material||n.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(var o=0,h=this.subMeshes;o<h.length;o++){var l=(p=h[o]).getMaterial();if(l)if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(this,p,a))return!1}else if(!l.isReady(this,a))return!1}else if(!s.isReady(this,a))return!1;for(var c=0,d=this.lightSources;c<d.length;c++){var u=d[c].getShadowGenerator();if(u)for(var f=0,g=this.subMeshes;f<g.length;f++){var p=g[f];if(!u.isReady(p,a))return!1}}for(var m=0,y=this._internalMeshDataInfo._LODLevels;m<y.length;m++){var v=y[m];if(v.mesh&&!v.mesh.isReady(a))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!0,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!0,configurable:!0}),t.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),t),this},t.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var i=this.getIndices();if(!i)return null;var r=i.length,n=!1;if(e)n=!0;else for(var a=0,s=this.subMeshes;a<s.length;a++){var o=s[a];if(o.indexStart+o.indexCount>=r){n=!0;break}if(o.verticesStart+o.verticesCount>=t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new p.b(0,0,t,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),i=t/e|0,r=0;i%3!=0;)i++;this.releaseSubMeshes();for(var n=0;n<e&&!(r>=t);n++)p.b.CreateFromIndices(0,r,Math.min(i,t-r),this),r+=i;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,t,i,r){if(void 0===i&&(i=!1),this._geometry)this._geometry.setVerticesData(e,t,i,r);else{var n=new u.a;n.set(t,e);var a=this.getScene();new f.a(f.a.RandomId(),a,n,i,this)}return this},t.prototype.removeVerticesData=function(e){this._geometry&&this._geometry.removeVerticesData(e)},t.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},t.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=f.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},t.prototype.updateVerticesData=function(e,t,i,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this},t.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var i=this.getVerticesData(d.b.PositionKind);if(!i)return this;if(e(i),this.updateVerticesData(d.b.PositionKind,i,!1,!1),t){var r=this.getIndices(),n=this.getVerticesData(d.b.NormalKind);if(!n)return this;u.a.ComputeNormals(i,r,n),this.updateVerticesData(d.b.NormalKind,n,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var e=this._geometry,t=this._geometry.copy(f.a.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},t.prototype.setIndices=function(e,t,i){if(void 0===t&&(t=null),void 0===i&&(i=!1),this._geometry)this._geometry.setIndices(e,t,i);else{var r=new u.a;r.indices=e;var n=this.getScene();new f.a(f.a.RandomId(),n,r,i,this)}return this},t.prototype.updateIndices=function(e,t,i){return void 0===i&&(i=!1),this._geometry?(this._geometry.updateIndices(e,t,i),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r,n=this.getScene().getEngine();if(this._unIndexed)r=null;else switch(i){case y.a.PointFillMode:r=null;break;case y.a.WireFrameFillMode:r=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case y.a.TriangleFillMode:r=this._geometry.getIndexBuffer()}return this._geometry._bind(t,r),this},t.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var r=this.getScene().getEngine();return this._unIndexed||t==y.a.PointFillMode?r.drawArraysType(t,e.verticesStart,e.verticesCount,i):t==y.a.WireFrameFillMode?r.drawElementsType(t,0,e._linesIndexCount,i):r.drawElementsType(t,e.indexStart,e.indexCount,i),this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e,t){if(void 0===t&&(t=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var i=this.getScene(),r=i._isInIntermediateRendering(),n=r?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,a=this._instanceDataStorage.batchCache;if(a.mustReturn=!1,a.renderSelf[e]=t||!n&&this.isEnabled()&&this.isVisible,a.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){var s=this._instanceDataStorage.visibleInstances,o=i.getRenderId(),h=r?s.intermediateDefaultRenderId:s.defaultRenderId;a.visibleInstances[e]=s[o],!a.visibleInstances[e]&&h&&(a.visibleInstances[e]=s[h])}return a.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==a.visibleInstances[e]&&void 0!==a.visibleInstances[e],this._instanceDataStorage.previousBatch=a,a},t.prototype._renderWithInstances=function(e,t,i,r,n){var a=i.visibleInstances[e._id];if(!a)return this;for(var s=this._instanceDataStorage,o=s.instancesBufferSize,h=s.instancesBuffer,l=16*(a.length+1)*4;s.instancesBufferSize<l;)s.instancesBufferSize*=2;s.instancesData&&o==s.instancesBufferSize||(s.instancesData=new Float32Array(s.instancesBufferSize/4));var c=0,u=0,f=i.renderSelf[e._id];if(this._instanceDataStorage.manualUpdate)u=(f?1:0)+a.length;else{var g=this._effectiveMesh.getWorldMatrix();if(f&&(g.copyToArray(s.instancesData,c),c+=16,u++),a)for(var p=0;p<a.length;p++){a[p].getWorldMatrix().copyToArray(s.instancesData,c),c+=16,u++}}return h&&o==s.instancesBufferSize?h.updateDirectly(s.instancesData,0,u):(h&&h.dispose(),h=new d.a(n,s.instancesData,!0,16,!1,!0),s.instancesBuffer=h,this.setVerticesBuffer(h.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(h.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(h.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(h.createVertexBuffer("world3",12,4))),this._processInstancedBuffers(a,f),this.getScene()._activeIndices.addCount(e.indexCount*u,!1),this._bind(e,r,t),this._draw(e,t,u),n.unbindInstanceAttributes(),this},t.prototype._processInstancedBuffers=function(e,t){},t.prototype._processRendering=function(e,t,i,r,n,a,s){var o=this.getScene(),h=o.getEngine();if(n)this._renderWithInstances(e,i,r,t,h);else{var l=0;r.renderSelf[e._id]&&(a&&a(!1,this._effectiveMesh.getWorldMatrix(),s),l++,this._draw(e,i,this._instanceDataStorage.overridenInstanceCount));var c=r.visibleInstances[e._id];if(c){var d=c.length;l+=d;for(var u=0;u<d;u++){var f=c[u].getWorldMatrix();a&&a(!0,f,s),this._draw(e,i)}}o._activeIndices.addCount(e.indexCount*l,!1)}return this},t.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),e.prototype._rebuild.call(this)},t.prototype._freeze=function(){if(this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},t.prototype.render=function(e,t,i){var r=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var n=this._getInstancesRenderList(e._id,!!i);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var a,s=r.getEngine(),o=n.hardwareInstancedRendering[e._id],h=this._instanceDataStorage,l=e.getMaterial();if(!l)return this;if(!h.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==l){if(l._storeEffectOnSubMeshes){if(!l.isReadyForSubMesh(this,e,o))return this}else if(!l.isReady(this,o))return this;this._effectiveMaterial=l}t&&s.setAlphaMode(this._effectiveMaterial.alphaMode);for(var c=0,d=r._beforeRenderingMeshStage;c<d.length;c++){d[c].action(this,e,n)}if(!(a=this._effectiveMaterial._storeEffectOnSubMeshes?e.effect:this._effectiveMaterial.getEffect()))return this;var u,f=i||this._effectiveMesh;if(!h.isFrozen&&this._effectiveMaterial.backFaceCulling){var g=f._getWorldMatrixDeterminant();null==(u=this.overrideMaterialSideOrientation)&&(u=this._effectiveMaterial.sideOrientation),g<0&&(u=u===y.a.ClockWiseSideOrientation?y.a.CounterClockWiseSideOrientation:y.a.ClockWiseSideOrientation),h.sideOrientation=u}else u=h.sideOrientation;var p=this._effectiveMaterial._preBind(a,u);this._effectiveMaterial.forceDepthWrite&&s.setDepthWrite(!0);var m=r.forcePointsCloud?y.a.PointFillMode:r.forceWireframe?y.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),o||this._bind(e,a,m);var v=f.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(v,this,e):this._effectiveMaterial.bind(v,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(s.setState(!0,this._effectiveMaterial.zOffset,!1,!p),this._processRendering(e,a,m,n,o,this._onBeforeDraw,this._effectiveMaterial),s.setState(!0,this._effectiveMaterial.zOffset,!1,p)),this._processRendering(e,a,m,n,o,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var b=0,_=r._afterRenderingMeshStage;b<_.length;b++){_[b].action(this,e,n)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},t.prototype._onBeforeDraw=function(e,t,i){e&&i&&i.bindOnlyWorldMatrix(t)},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(d.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(d.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},t.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(d.b.MatricesWeightsKind),t=e.length,i=0;i<t;i+=4){var r=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===r)e[i]=1;else{var n=1/r;e[i]*=n,e[i+1]*=n,e[i+2]*=n,e[i+3]*=n}}this.setVerticesData(d.b.MatricesWeightsKind,e)},t.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(d.b.MatricesWeightsExtraKind),t=this.getVerticesData(d.b.MatricesWeightsKind),i=t.length,r=0;r<i;r+=4){var n=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===(n+=e[r]+e[r+1]+e[r+2]+e[r+3]))t[r]=1;else{var a=1/n;t[r]*=a,t[r+1]*=a,t[r+2]*=a,t[r+3]*=a,e[r]*=a,e[r+1]*=a,e[r+2]*=a,e[r+3]*=a}}this.setVerticesData(d.b.MatricesWeightsKind,t),this.setVerticesData(d.b.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(d.b.MatricesWeightsExtraKind),t=this.getVerticesData(d.b.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var i=t.length,r=0,n=0,a=0,s=0,o=null===e?4:8,h=new Array,l=0;l<=o;l++)h[l]=0;for(l=0;l<i;l+=4){for(var c=t[l],u=c,f=0===u?0:1,g=1;g<o;g++){var p=g<4?t[l+g]:e[l+g-4];p>c&&r++,0!==p&&f++,u+=p,c=p}if(h[f]++,f>a&&(a=f),0===u)n++;else{var m=1/u,y=0;for(g=0;g<o;g++)y+=g<4?Math.abs(t[l+g]-t[l+g]*m):Math.abs(e[l+g-4]-e[l+g-4]*m);y>.001&&s++}}var v=this.skeleton.bones.length,b=this.getVerticesData(d.b.MatricesIndicesKind),_=this.getVerticesData(d.b.MatricesIndicesExtraKind),M=0;for(l=0;l<i;l++)for(g=0;g<o;g++){var I=g<4?b[g]:_[g-4];(I>=v||I<0)&&M++}return{skinned:!0,valid:0===n&&0===s&&0===M,report:"Number of Weights = "+i/4+"\nMaximum influences = "+a+"\nMissing Weights = "+n+"\nNot Sorted = "+r+"\nNot Normalized = "+s+"\nWeightCounts = ["+h+"]\nNumber of bones = "+v+"\nBad Bone Indices = "+M}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var i=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return a.b.LoadFile(this.delayLoadingFile,(function(i){i instanceof ArrayBuffer?t._delayLoadingFunction(i,t):t._delayLoadingFunction(JSON.parse(i),t),t.instances.forEach((function(e){e.refreshBoundingInfo(),e._syncSubMeshes()})),t.delayLoadState=1,e._removePendingData(t)}),(function(){}),e.offlineProvider,i),this},t.prototype.isInFrustum=function(t){return 2!==this.delayLoadState&&(!!e.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0))},t.prototype.setMaterialByID=function(e){var t,i=this.getScene().materials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;var r=this.getScene().multiMaterials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(d.b.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var i,r=this.getVerticesData(d.b.PositionKind),n=new Array;for(i=0;i<r.length;i+=3)h.e.TransformCoordinates(h.e.FromArray(r,i),e).toArray(n,i);if(this.setVerticesData(d.b.PositionKind,n,this.getVertexBuffer(d.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(d.b.NormalKind)){for(r=this.getVerticesData(d.b.NormalKind),n=[],i=0;i<r.length;i+=3)h.e.TransformNormal(h.e.FromArray(r,i),e).normalize().toArray(n,i);this.setVerticesData(d.b.NormalKind,n,this.getVertexBuffer(d.b.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},t.prototype.bakeCurrentTransformIntoVertices=function(e){return void 0===e&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(e,i,r,n){return void 0===e&&(e=""),void 0===i&&(i=null),void 0===n&&(n=!0),new t(e,this.getScene(),i,this,r,n)},t.prototype.dispose=function(t,i){void 0===i&&(i=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var r=this._internalMeshDataInfo;if(r._onBeforeDrawObservable&&r._onBeforeDrawObservable.clear(),r._onBeforeBindObservable&&r._onBeforeBindObservable.clear(),r._onBeforeRenderObservable&&r._onBeforeRenderObservable.clear(),r._onAfterRenderObservable&&r._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(r.meshMap)for(var n in r.meshMap){(o=r.meshMap[n])&&(o._internalMeshDataInfo._source=null,r.meshMap[n]=void 0)}r._source&&r._source._internalMeshDataInfo.meshMap&&(r._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var a=0,s=this.getScene().meshes;a<s.length;a++){var o;(o=s[a])._internalMeshDataInfo&&o._internalMeshDataInfo._source&&o._internalMeshDataInfo._source===this&&(o._internalMeshDataInfo._source=null)}r._source=null,this._disposeInstanceSpecificData(),e.prototype.dispose.call(this,t,i)},t.prototype._disposeInstanceSpecificData=function(){},t.prototype.applyDisplacementMap=function(e,t,i,r,n,s,o){var h=this;void 0===o&&(o=!1);var l=this.getScene();return a.b.LoadImage(e,(function(e){var a=e.width,l=e.height,c=B.a.CreateCanvas(a,l).getContext("2d");c.drawImage(e,0,0);var d=c.getImageData(0,0,a,l).data;h.applyDisplacementMapFromBuffer(d,a,l,t,i,n,s,o),r&&r(h)}),(function(){}),l.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,t,i,r,n,a,s,o){if(void 0===o&&(o=!1),!this.isVerticesDataPresent(d.b.PositionKind)||!this.isVerticesDataPresent(d.b.NormalKind)||!this.isVerticesDataPresent(d.b.UVKind))return M.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var l=this.getVerticesData(d.b.PositionKind,!0,!0),c=this.getVerticesData(d.b.NormalKind),f=this.getVerticesData(d.b.UVKind),g=h.e.Zero(),p=h.e.Zero(),m=h.d.Zero();a=a||h.d.Zero(),s=s||new h.d(1,1);for(var y=0;y<l.length;y+=3){h.e.FromArrayToRef(l,y,g),h.e.FromArrayToRef(c,y,p),h.d.FromArrayToRef(f,y/3*2,m);var v=4*((Math.abs(m.x*s.x+a.x)*t%t|0)+(Math.abs(m.y*s.y+a.y)*i%i|0)*t),b=.3*(e[v]/255)+.59*(e[v+1]/255)+.11*(e[v+2]/255);p.normalize(),p.scaleInPlace(r+(n-r)*b),(g=g.add(p)).toArray(l,y)}return u.a.ComputeNormals(l,this.getIndices(),c),o?(this.setVerticesData(d.b.PositionKind,l),this.setVerticesData(d.b.NormalKind,c)):(this.updateVerticesData(d.b.PositionKind,l),this.updateVerticesData(d.b.NormalKind,c)),this},t.prototype.convertToFlatShadedMesh=function(){var e,t,i=this.getVerticesDataKinds(),r={},n={},a={},s=!1;for(e=0;e<i.length;e++){t=i[e];var o=this.getVertexBuffer(t);t!==d.b.NormalKind?(r[t]=o,n[t]=r[t].getData(),a[t]=[]):(s=o.isUpdatable(),i.splice(e,1),e--)}var l,c=this.subMeshes.slice(0),u=this.getIndices(),f=this.getTotalIndices();for(l=0;l<f;l++){var g=u[l];for(e=0;e<i.length;e++)for(var m=r[t=i[e]].getStrideSize(),y=0;y<m;y++)a[t].push(n[t][g*m+y])}var v=[],b=a[d.b.PositionKind];for(l=0;l<f;l+=3){u[l]=l,u[l+1]=l+1,u[l+2]=l+2;for(var _=h.e.FromArray(b,3*l),M=h.e.FromArray(b,3*(l+1)),I=h.e.FromArray(b,3*(l+2)),D=_.subtract(M),S=I.subtract(M),A=h.e.Normalize(h.e.Cross(D,S)),B=0;B<3;B++)v.push(A.x),v.push(A.y),v.push(A.z)}for(this.setIndices(u),this.setVerticesData(d.b.NormalKind,v,s),e=0;e<i.length;e++)t=i[e],this.setVerticesData(t,a[t],r[t].isUpdatable());this.releaseSubMeshes();for(var x=0;x<c.length;x++){var O=c[x];p.b.AddToMesh(O.materialIndex,O.indexStart,O.indexCount,O.indexStart,O.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e,t,i=this.getVerticesDataKinds(),r={},n={},a={};for(e=0;e<i.length;e++){t=i[e];var s=this.getVertexBuffer(t);r[t]=s,n[t]=r[t].getData(),a[t]=[]}var o,h=this.subMeshes.slice(0),l=this.getIndices(),c=this.getTotalIndices();for(o=0;o<c;o++){var d=l[o];for(e=0;e<i.length;e++)for(var u=r[t=i[e]].getStrideSize(),f=0;f<u;f++)a[t].push(n[t][d*u+f])}for(o=0;o<c;o+=3)l[o]=o,l[o+1]=o+1,l[o+2]=o+2;for(this.setIndices(l),e=0;e<i.length;e++)t=i[e],this.setVerticesData(t,a[t],r[t].isUpdatable());this.releaseSubMeshes();for(var g=0;g<h.length;g++){var m=h[g];p.b.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,i,r=u.a.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(d.b.NormalKind)&&r.normals)for(t=0;t<r.normals.length;t++)r.normals[t]*=-1;if(r.indices)for(t=0;t<r.indices.length;t+=3)i=r.indices[t+1],r.indices[t+1]=r.indices[t+2],r.indices[t+2]=i;return r.applyToMesh(this,this.isVertexBufferUpdatable(d.b.PositionKind)),this},t.prototype.increaseVertices=function(e){var t=u.a.ExtractFromMesh(this),i=t.uvs,r=t.indices,n=t.positions,a=t.normals;if(null===r||null===n||null===a||null===i)M.a.Warn("VertexData contains null entries");else{for(var s,o,l=e+1,c=new Array,f=0;f<l+1;f++)c[f]=new Array;var g,p=new h.e(0,0,0),m=new h.e(0,0,0),y=new h.d(0,0),v=new Array,b=new Array,_=new Array,I=n.length,D=i.length;for(f=0;f<r.length;f+=3){b[0]=r[f],b[1]=r[f+1],b[2]=r[f+2];for(var S=0;S<3;S++)if(s=b[S],o=b[(S+1)%3],void 0===_[s]&&void 0===_[o]?(_[s]=new Array,_[o]=new Array):(void 0===_[s]&&(_[s]=new Array),void 0===_[o]&&(_[o]=new Array)),void 0===_[s][o]&&void 0===_[o][s]){_[s][o]=[],p.x=(n[3*o]-n[3*s])/l,p.y=(n[3*o+1]-n[3*s+1])/l,p.z=(n[3*o+2]-n[3*s+2])/l,m.x=(a[3*o]-a[3*s])/l,m.y=(a[3*o+1]-a[3*s+1])/l,m.z=(a[3*o+2]-a[3*s+2])/l,y.x=(i[2*o]-i[2*s])/l,y.y=(i[2*o+1]-i[2*s+1])/l,_[s][o].push(s);for(var A=1;A<l;A++)_[s][o].push(n.length/3),n[I]=n[3*s]+A*p.x,a[I++]=a[3*s]+A*m.x,n[I]=n[3*s+1]+A*p.y,a[I++]=a[3*s+1]+A*m.y,n[I]=n[3*s+2]+A*p.z,a[I++]=a[3*s+2]+A*m.z,i[D++]=i[2*s]+A*y.x,i[D++]=i[2*s+1]+A*y.y;_[s][o].push(o),_[o][s]=new Array,g=_[s][o].length;for(var B=0;B<g;B++)_[o][s][B]=_[s][o][g-1-B]}c[0][0]=r[f],c[1][0]=_[r[f]][r[f+1]][1],c[1][1]=_[r[f]][r[f+2]][1];for(A=2;A<l;A++){c[A][0]=_[r[f]][r[f+1]][A],c[A][A]=_[r[f]][r[f+2]][A],p.x=(n[3*c[A][A]]-n[3*c[A][0]])/A,p.y=(n[3*c[A][A]+1]-n[3*c[A][0]+1])/A,p.z=(n[3*c[A][A]+2]-n[3*c[A][0]+2])/A,m.x=(a[3*c[A][A]]-a[3*c[A][0]])/A,m.y=(a[3*c[A][A]+1]-a[3*c[A][0]+1])/A,m.z=(a[3*c[A][A]+2]-a[3*c[A][0]+2])/A,y.x=(i[2*c[A][A]]-i[2*c[A][0]])/A,y.y=(i[2*c[A][A]+1]-i[2*c[A][0]+1])/A;for(S=1;S<A;S++)c[A][S]=n.length/3,n[I]=n[3*c[A][0]]+S*p.x,a[I++]=a[3*c[A][0]]+S*m.x,n[I]=n[3*c[A][0]+1]+S*p.y,a[I++]=a[3*c[A][0]+1]+S*m.y,n[I]=n[3*c[A][0]+2]+S*p.z,a[I++]=a[3*c[A][0]+2]+S*m.z,i[D++]=i[2*c[A][0]]+S*y.x,i[D++]=i[2*c[A][0]+1]+S*y.y}c[l]=_[r[f+1]][r[f+2]],v.push(c[0][0],c[1][0],c[1][1]);for(A=1;A<l;A++){for(S=0;S<A;S++)v.push(c[A][S],c[A+1][S],c[A+1][S+1]),v.push(c[A][S],c[A+1][S+1],c[A][S+1]);v.push(c[A][S],c[A+1][S],c[A+1][S+1])}}t.indices=v,t.applyToMesh(this,this.isVertexBufferUpdatable(d.b.PositionKind))}},t.prototype.forceSharedVertices=function(){var e=u.a.ExtractFromMesh(this),t=e.uvs,i=e.indices,r=e.positions,n=e.colors;if(void 0===i||void 0===r||null===i||null===r)M.a.Warn("VertexData contains empty entries");else{for(var a,s,o=new Array,h=new Array,l=new Array,c=new Array,f=new Array,g=0,p=new Array,m=0;m<i.length;m+=3){s=[i[m],i[m+1],i[m+2]],f=new Array;for(var y=0;y<3;y++){f[y]="";for(var v=0;v<3;v++)Math.abs(r[3*s[y]+v])<1e-8&&(r[3*s[y]+v]=0),f[y]+=r[3*s[y]+v]+"|";f[y]=f[y].slice(0,-1)}if(f[0]!=f[1]&&f[0]!=f[2]&&f[1]!=f[2])for(y=0;y<3;y++){if((a=p.indexOf(f[y]))<0){p.push(f[y]),a=g++;for(v=0;v<3;v++)o.push(r[3*s[y]+v]);if(null!=n)for(v=0;v<4;v++)c.push(n[4*s[y]+v]);if(null!=t)for(v=0;v<2;v++)l.push(t[2*s[y]+v])}h.push(a)}}var b=new Array;u.a.ComputeNormals(o,h,b),e.positions=o,e.indices=h,e.normals=b,null!=t&&(e.uvs=l),null!=n&&(e.colors=c),e.applyToMesh(this,this.isVertexBufferUpdatable(d.b.PositionKind))}},t._instancedMeshFactory=function(e,t){throw D.a.WarnImport("InstancedMesh")},t._PhysicsImpostorParser=function(e,t,i){throw D.a.WarnImport("PhysicsImpostor")},t.prototype.createInstance=function(e){return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},t.prototype.optimizeIndices=function(e){var t=this,i=this.getIndices(),r=this.getVerticesData(d.b.PositionKind);if(!r||!i)return this;for(var n=new Array,s=0;s<r.length;s+=3)n.push(h.e.FromArray(r,s));var o=new Array;return a.a.SyncAsyncForLoop(n.length,40,(function(e){for(var t=n.length-1-e,i=n[t],r=0;r<t;++r){var a=n[r];if(i.equals(a)){o[t]=r;break}}}),(function(){for(var r=0;r<i.length;++r)i[r]=o[i[r]]||i[r];var n=t.subMeshes.slice(0);t.setIndices(i),t.subMeshes=n,e&&e(t)})),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.type=this.getClassName(),o.a&&o.a.HasTags(this)&&(e.tags=o.a.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t){var i=t.id;e.geometryId=i,e.subMeshes=[];for(var r=0;r<this.subMeshes.length;r++){var n=this.subMeshes[r];e.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialId=this.material.id):this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id),this.getScene()._getComponent(S.a.NAME_PHYSICSENGINE)){var a=this.getPhysicsImpostor();a&&(e.physicsMass=a.getParam("mass"),e.physicsFriction=a.getParam("friction"),e.physicsRestitution=a.getParam("mass"),e.physicsImpostor=a.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var s=0;s<this.instances.length;s++){var h=this.instances[s];if(!h.doNotSerialize){var l={name:h.name,id:h.id,position:h.position.asArray(),scaling:h.scaling.asArray()};h.parent&&(l.parentId=h.parent.id),h.rotationQuaternion?l.rotationQuaternion=h.rotationQuaternion.asArray():h.rotation&&(l.rotation=h.rotation.asArray()),e.instances.push(l),_.a.AppendSerializedAnimations(h,l),l.ranges=h.serializeAnimationRanges()}}_.a.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return M.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var t=0;t<e.numInfluencers;t++){var i=e.getActiveTarget(t),r=i.getPositions();if(!r)return void M.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(d.b.PositionKind+t,r,!1,3);var n=i.getNormals();n&&this.geometry.setVerticesData(d.b.NormalKind+t,n,!1,3);var a=i.getTangents();a&&this.geometry.setVerticesData(d.b.TangentKind+t,a,!1,3);var s=i.getUVs();s&&this.geometry.setVerticesData(d.b.UVKind+"_"+t,s,!1,2)}}else for(t=0;this.geometry.isVerticesDataPresent(d.b.PositionKind+t);)this.geometry.removeVerticesData(d.b.PositionKind+t),this.geometry.isVerticesDataPresent(d.b.NormalKind+t)&&this.geometry.removeVerticesData(d.b.NormalKind+t),this.geometry.isVerticesDataPresent(d.b.TangentKind+t)&&this.geometry.removeVerticesData(d.b.TangentKind+t),this.geometry.isVerticesDataPresent(d.b.UVKind+t)&&this.geometry.removeVerticesData(d.b.UVKind+"_"+t),t++}},t.Parse=function(e,i,r){var n;if((n=e.type&&"GroundMesh"===e.type?t._GroundMeshParser(e,i):new t(e.name,i)).id=e.id,o.a&&o.a.AddTagsTo(n,e.tags),n.position=h.e.FromArray(e.position),void 0!==e.metadata&&(n.metadata=e.metadata),e.rotationQuaternion?n.rotationQuaternion=h.b.FromArray(e.rotationQuaternion):e.rotation&&(n.rotation=h.e.FromArray(e.rotation)),n.scaling=h.e.FromArray(e.scaling),e.localMatrix?n.setPreTransformMatrix(h.a.FromArray(e.localMatrix)):e.pivotMatrix&&n.setPivotMatrix(h.a.FromArray(e.pivotMatrix)),n.setEnabled(e.isEnabled),n.isVisible=e.isVisible,n.infiniteDistance=e.infiniteDistance,n.showBoundingBox=e.showBoundingBox,n.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(n.applyFog=e.applyFog),void 0!==e.pickable&&(n.isPickable=e.pickable),void 0!==e.alphaIndex&&(n.alphaIndex=e.alphaIndex),n.receiveShadows=e.receiveShadows,n.billboardMode=e.billboardMode,void 0!==e.visibility&&(n.visibility=e.visibility),n.checkCollisions=e.checkCollisions,n.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(n.isBlocker=e.isBlocker),n._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(n._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.actions&&(n._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(n.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(n.overlayColor=l.a.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(n.renderOverlay=e.renderOverlay),n.isUnIndexed=!!e.isUnIndexed,n.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=r+e.delayLoadingFile,n._boundingInfo=new m.a(h.e.FromArray(e.boundingBoxMinimum),h.e.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(n._binaryInfo=e._binaryInfo),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(d.b.UVKind),e.hasUVs2&&n._delayInfo.push(d.b.UV2Kind),e.hasUVs3&&n._delayInfo.push(d.b.UV3Kind),e.hasUVs4&&n._delayInfo.push(d.b.UV4Kind),e.hasUVs5&&n._delayInfo.push(d.b.UV5Kind),e.hasUVs6&&n._delayInfo.push(d.b.UV6Kind),e.hasColors&&n._delayInfo.push(d.b.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(d.b.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(d.b.MatricesWeightsKind),n._delayLoadingFunction=f.a._ImportGeometry,b.a.ForceFullSceneLoadingForIncremental&&n._checkDelayState()):f.a._ImportGeometry(e,n),e.materialId?n.setMaterialByID(e.materialId):n.material=null,e.morphTargetManagerId>-1&&(n.morphTargetManager=i.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId>-1&&(n.skeleton=i.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(n.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var a=0;a<e.animations.length;a++){var s=e.animations[a];(y=I.a.GetClass("BABYLON.Animation"))&&n.animations.push(y.Parse(s))}c.a.ParseAnimationRanges(n,e,i)}if(e.autoAnimate&&i.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?n.layerMask=Math.abs(parseInt(e.layerMask)):n.layerMask=268435455,e.physicsImpostor&&t._PhysicsImpostorParser(i,n,e),e.lodMeshIds&&(n._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var u=0;u<e.instances.length;u++){var g=e.instances[u],p=n.createInstance(g.name);if(g.id&&(p.id=g.id),o.a&&(g.tags?o.a.AddTagsTo(p,g.tags):o.a.AddTagsTo(p,e.tags)),p.position=h.e.FromArray(g.position),void 0!==g.metadata&&(p.metadata=g.metadata),g.parentId&&(p._waitingParentId=g.parentId),g.rotationQuaternion?p.rotationQuaternion=h.b.FromArray(g.rotationQuaternion):g.rotation&&(p.rotation=h.e.FromArray(g.rotation)),p.scaling=h.e.FromArray(g.scaling),null!=g.checkCollisions&&null!=g.checkCollisions&&(p.checkCollisions=g.checkCollisions),null!=g.pickable&&null!=g.pickable&&(p.isPickable=g.pickable),null!=g.showBoundingBox&&null!=g.showBoundingBox&&(p.showBoundingBox=g.showBoundingBox),null!=g.showSubMeshesBoundingBox&&null!=g.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=g.showSubMeshesBoundingBox),null!=g.alphaIndex&&null!=g.showSubMeshesBoundingBox&&(p.alphaIndex=g.alphaIndex),g.physicsImpostor&&t._PhysicsImpostorParser(i,p,g),g.animations){for(a=0;a<g.animations.length;a++){var y;s=g.animations[a],(y=I.a.GetClass("BABYLON.Animation"))&&p.animations.push(y.Parse(s))}c.a.ParseAnimationRanges(p,g,i),g.autoAnimate&&i.beginAnimation(p,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1)}}return n},t.CreateRibbon=function(e,t,i,r,n,a,s,o,h){throw D.a.WarnImport("MeshBuilder")},t.CreateDisc=function(e,t,i,r,n,a){throw void 0===r&&(r=null),D.a.WarnImport("MeshBuilder")},t.CreateBox=function(e,t,i,r,n){throw void 0===i&&(i=null),D.a.WarnImport("MeshBuilder")},t.CreateSphere=function(e,t,i,r,n,a){throw D.a.WarnImport("MeshBuilder")},t.CreateHemisphere=function(e,t,i,r){throw D.a.WarnImport("MeshBuilder")},t.CreateCylinder=function(e,t,i,r,n,a,s,o,h){throw D.a.WarnImport("MeshBuilder")},t.CreateTorus=function(e,t,i,r,n,a,s){throw D.a.WarnImport("MeshBuilder")},t.CreateTorusKnot=function(e,t,i,r,n,a,s,o,h,l){throw D.a.WarnImport("MeshBuilder")},t.CreateLines=function(e,t,i,r,n){throw void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null),D.a.WarnImport("MeshBuilder")},t.CreateDashedLines=function(e,t,i,r,n,a,s,o){throw void 0===a&&(a=null),D.a.WarnImport("MeshBuilder")},t.CreatePolygon=function(e,t,i,r,n,a,s){throw void 0===s&&(s=earcut),D.a.WarnImport("MeshBuilder")},t.ExtrudePolygon=function(e,t,i,r,n,a,s,o){throw void 0===o&&(o=earcut),D.a.WarnImport("MeshBuilder")},t.ExtrudeShape=function(e,t,i,r,n,a,s,o,h,l){throw void 0===s&&(s=null),D.a.WarnImport("MeshBuilder")},t.ExtrudeShapeCustom=function(e,t,i,r,n,a,s,o,h,l,c,d){throw D.a.WarnImport("MeshBuilder")},t.CreateLathe=function(e,t,i,r,n,a,s){throw D.a.WarnImport("MeshBuilder")},t.CreatePlane=function(e,t,i,r,n){throw D.a.WarnImport("MeshBuilder")},t.CreateGround=function(e,t,i,r,n,a){throw D.a.WarnImport("MeshBuilder")},t.CreateTiledGround=function(e,t,i,r,n,a,s,o,h){throw D.a.WarnImport("MeshBuilder")},t.CreateGroundFromHeightMap=function(e,t,i,r,n,a,s,o,h,l,c){throw D.a.WarnImport("MeshBuilder")},t.CreateTube=function(e,t,i,r,n,a,s,o,h,l){throw D.a.WarnImport("MeshBuilder")},t.CreatePolyhedron=function(e,t,i){throw D.a.WarnImport("MeshBuilder")},t.CreateIcoSphere=function(e,t,i){throw D.a.WarnImport("MeshBuilder")},t.CreateDecal=function(e,t,i,r,n,a){throw D.a.WarnImport("MeshBuilder")},t.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(d.b.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(d.b.PositionKind)||this.setVerticesData(d.b.PositionKind,t,!0)}return e._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(d.b.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(d.b.NormalKind)||this.setVerticesData(d.b.NormalKind,t,!0)}return e._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(d.b.PositionKind))return this;if(!this.isVerticesDataPresent(d.b.NormalKind))return this;if(!this.isVerticesDataPresent(d.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(d.b.MatricesWeightsKind))return this;var t=this._internalMeshDataInfo;if(!t._sourcePositions){var i=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=i}t._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(d.b.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var n=this.getVerticesData(d.b.NormalKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var a=this.getVerticesData(d.b.MatricesIndicesKind),s=this.getVerticesData(d.b.MatricesWeightsKind);if(!s||!a)return this;for(var o,l=this.numBoneInfluencers>4,c=l?this.getVerticesData(d.b.MatricesIndicesExtraKind):null,u=l?this.getVerticesData(d.b.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),g=h.e.Zero(),p=new h.a,m=new h.a,y=0,v=0;v<r.length;v+=3,y+=4){var b;for(o=0;o<4;o++)(b=s[y+o])>0&&(h.a.FromFloat32ArrayToRefScaled(f,Math.floor(16*a[y+o]),b,m),p.addToSelf(m));if(l)for(o=0;o<4;o++)(b=u[y+o])>0&&(h.a.FromFloat32ArrayToRefScaled(f,Math.floor(16*c[y+o]),b,m),p.addToSelf(m));h.e.TransformCoordinatesFromFloatsToRef(t._sourcePositions[v],t._sourcePositions[v+1],t._sourcePositions[v+2],p,g),g.toArray(r,v),h.e.TransformNormalFromFloatsToRef(t._sourceNormals[v],t._sourceNormals[v+1],t._sourceNormals[v+2],p,g),g.toArray(n,v),p.reset()}return this.updateVerticesData(d.b.PositionKind,r),this.updateVerticesData(d.b.NormalKind,n),this},t.MinMax=function(e){var t=null,i=null;return e.forEach((function(e){var r=e.getBoundingInfo().boundingBox;t&&i?(t.minimizeInPlace(r.minimumWorld),i.maximizeInPlace(r.maximumWorld)):(t=r.minimumWorld,i=r.maximumWorld)})),t&&i?{min:t,max:i}:{min:h.e.Zero(),max:h.e.Zero()}},t.Center=function(e){var i=e instanceof Array?t.MinMax(e):e;return h.e.Center(i.min,i.max)},t.MergeMeshes=function(e,i,r,n,a,s){var o;if(void 0===i&&(i=!0),!r){var h=0;for(o=0;o<e.length;o++)if(e[o]&&(h+=e[o].getTotalVertices())>=65536)return M.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(s){var l,c,d=null;a=!1}var f,g=new Array,m=new Array,y=null,b=new Array,_=null;for(o=0;o<e.length;o++)if(e[o]){var I=e[o];if(I.isAnInstance)return M.a.Warn("Cannot merge instance meshes."),null;var D=I.computeWorldMatrix(!0);if((f=u.a.ExtractFromMesh(I,!0,!0)).transform(D),y?y.merge(f,r):(y=f,_=I),a&&b.push(I.getTotalIndices()),s)if(I.material){var S=I.material;if(S instanceof v.a){for(c=0;c<S.subMaterials.length;c++)g.indexOf(S.subMaterials[c])<0&&g.push(S.subMaterials[c]);for(l=0;l<I.subMeshes.length;l++)m.push(g.indexOf(S.subMaterials[I.subMeshes[l].materialIndex])),b.push(I.subMeshes[l].indexCount)}else for(g.indexOf(S)<0&&g.push(S),l=0;l<I.subMeshes.length;l++)m.push(g.indexOf(S)),b.push(I.subMeshes[l].indexCount)}else for(l=0;l<I.subMeshes.length;l++)m.push(0),b.push(I.subMeshes[l].indexCount)}if(_=_,n||(n=new t(_.name+"_merged",_.getScene())),y.applyToMesh(n),n.checkCollisions=_.checkCollisions,i)for(o=0;o<e.length;o++)e[o]&&e[o].dispose();if(a||s){n.releaseSubMeshes(),o=0;for(var A=0;o<b.length;)p.b.CreateFromIndices(0,A,b[o],n),A+=b[o],o++}if(s){for((d=new v.a(_.name+"_merged",_.getScene())).subMaterials=g,l=0;l<n.subMeshes.length;l++)n.subMeshes[l].materialIndex=m[l];n.material=d}else n.material=_.material;return n},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var i=this.instances[this.instances.length-1];this.instances[t]=i,i._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.FRONTSIDE=u.a.FRONTSIDE,t.BACKSIDE=u.a.BACKSIDE,t.DOUBLESIDE=u.a.DOUBLESIDE,t.DEFAULTSIDE=u.a.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t.NO_FLIP=0,t.FLIP_TILE=1,t.ROTATE_TILE=2,t.FLIP_ROW=3,t.ROTATE_ROW=4,t.FLIP_N_ROTATE_TILE=5,t.FLIP_N_ROTATE_ROW=6,t.CENTER=0,t.LEFT=1,t.RIGHT=2,t.TOP=3,t.BOTTOM=4,t._GroundMeshParser=function(e,t){throw D.a.WarnImport("GroundMesh")},t}(g.a)}}]);